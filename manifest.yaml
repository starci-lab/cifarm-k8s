---
# Source: cifarm-system/charts/wallet-service/templates/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: wallet-service
---
# Source: cifarm-system/charts/wallet-service/templates/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: build
---
# Source: cifarm-system/charts/wallet-service/templates/cluster-ip.yaml
apiVersion: v1
kind: Service
metadata:
  name: wallet-service
  namespace: wallet-service
  labels:
    mode: deploy
spec:
  selector:
    app.kubernetes.io/name: wallet-service
  ports:
    - protocol: TCP
      port: 3008
      targetPort: 3008
  type: ClusterIP
---
# Source: cifarm-system/charts/websocket-api-gateway/templates/cluster-ip.yaml
apiVersion: v1
kind: Service
metadata:
  name: websocket-api-gateway 
  namespace: websocket-api-gateway
  labels:
    mode: deploy
spec:
  selector:
    app.kubernetes.io/name: websocket-api-gateway
  ports:
    - protocol: TCP
      port: 3008
      targetPort: 3008
  type: ClusterIP
---
# Source: cifarm-system/charts/wallet-service/templates/kaniko-build.yaml
apiVersion: v1
kind: Pod
metadata:
  name: wallet-service-kaniko-build
  namespace: build
  labels:
    mode: build
spec:
  containers:
    - name: kaniko
      image: gcr.io/kaniko-project/executor:debug
      args:
        - "--context=git://github.com/starci-lab/cifarm-containers"
        - "--destination=cifarm/wallet-service:latest"
        - "--dockerfile=./apps/wallet-service/Dockerfile"
      resources:
        limits:
          cpu: 2
          memory: 2Gi
      volumeMounts:
        - name: kaniko-secret
          mountPath: /kaniko/.docker
  restartPolicy: Never
  volumes:
    - name: kaniko-secret
      secret:
        secretName: regcred
        items:
          - key: .dockerconfigjson
            path: config.json
---
# Source: cifarm-system/charts/websocket-api-gateway/templates/kaniko-build.yaml
apiVersion: v1
kind: Pod
metadata:
  name: websocket-api-gateway-kaniko-build
  namespace: build
  labels: 
    mode: build
spec:
  containers:
  - name: kaniko
    image: gcr.io/kaniko-project/executor:debug
    args:
      - "--context=git://github.com/starci-lab/cifarm-containers"
      - "--destination=cifarm/websocket-api-gateway:latest"
      - "--dockerfile=./apps/websocket-api-gateway/Dockerfile"
    resources:
      limits:
        cpu: "2"
        memory: "2Gi"
    volumeMounts:
      - name: kaniko-secret
        mountPath: /kaniko/.docker
  restartPolicy: Never
  volumes:
    - name: kaniko-secret
      secret:
        secretName: regcred
        items:
          - key: .dockerconfigjson
            path: config.json
---
# Source: cifarm-system/charts/wallet-service/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: wallet-service-deployment
  namespace: wallet-service
  labels:
    mode: deploy
spec:
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/name: wallet-service
  template:
    metadata:
      labels:
        app.kubernetes.io/name: wallet-service
    spec:
      containers:
        - name: wallet-service
          image: cifarm/wallet-service:latest
          resources:
            limits:
              cpu: 250m
              memory: 256Mi
          envFrom:
            - secretRef:
                name: wallet-service-env
          ports:
            - containerPort: 3008
---
# Source: cifarm-system/charts/websocket-api-gateway/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: websocket-api-gateway-deployment
  namespace: websocket-api-gateway
  labels:
    mode: deploy
spec:
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/name: websocket-api-gateway
  template:
    metadata:
      labels:
        app.kubernetes.io/name: websocket-api-gateway
    spec:
      containers:
        - name: websocket-api-gateway
          image: cifarm/websocket-api-gateway:latest
          resources:
            limits:
              cpu: "250m"
              memory: "256Mi"
          envFrom:
            - secretRef:
                name: websocket-api-gateway-env
          ports:
            - containerPort: 3008
---
# Source: cifarm-system/templates/ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: api-gateway-ingress
  namespace: gateway
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
spec:
  rules:
    # REST API Gateway
    - host: api.example.com
      http:
        paths:
          - path: /api
            pathType: Prefix
            backend:
              service:
                name: rest-api-gateway
                port:
                  number: 8080

    # GraphQL API Gateway
    - host: api.example.com
      http:
        paths:
          - path: /graphql
            pathType: Prefix
            backend:
              service:
                name: graphql-api-gateway
                port:
                  number: 8081

    # WebSocket API Gateway
    - host: api.example.com
      http:
        paths:
          - path: /websocket
            pathType: Prefix
            backend:
              service:
                name: websocket-api-gateway
                port:
                  number: 8082
  tls:
    - hosts:
        - api.example.com
      secretName: api-gateway-tls
