---
# Source: broadcast-service/templates/service-cluster-ip.yaml
apiVersion: v1
kind: Service
metadata:
  name: broadcast-service-cluster-ip 
  labels:
    mode: deploy
spec:
  selector:
    app.kubernetes.io/name: auth-service
  ports:
    - protocol: TCP
      port: 3004
      targetPort: 3004
  type: ClusterIP
---
# Source: broadcast-service/templates/kaniko-build.yaml
apiVersion: v1
kind: Pod
metadata:
  name: broadcast-service-kaniko-build
  labels: 
    mode: build
spec:
  containers:
  - name: kaniko
    image: gcr.io/kaniko-project/executor:debug
    args:
      - "--context=git://github.com/starci-lab/cifarm-containers"
      - "--destination=starci183/broadcast-service:latest"
      - "--dockerfile=./apps/broadcast-service/Dockerfile"
    resources:
      limits:
        cpu: "2"
        memory: "2Gi"
    volumeMounts:
      - name: kaniko-secret
        mountPath: /kaniko/.docker
  restartPolicy: Never
  volumes:
    - name: kaniko-secret
      secret:
        secretName: regcred
        items:
          - key: .dockerconfigjson
            path: config.json
---
# Source: broadcast-service/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: broadcast-service-deployment
  labels:
    mode: deploy
spec:
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/name: broadcast-service
  template:
    metadata:
      labels:
        app.kubernetes.io/name: broadcast-service
    spec:
      containers:
        - name: broadcast-service
          image: starci183/broadcast-service:latest
          resources:
            limits:
              cpu: "1"
              memory: "1Gi"
          envFrom:
            - secretRef:
                name: broadcast-service-env
          ports:
            - containerPort: 3004

#kubectl exec -it broadcast-service-deployment-67448d654f-8jrwf -- netstat -tuln
